const DEFAULT_SEARCH="Felis silvestris catus",VAPID_PUBLIC_KEY="BHuCD9Ym4yXI9Fk0KHrRcPgH2iQOXhoWbzWtm4GQocD1zGYz4IXyazINE_-T4pEojrAgqoGoRnxUgX5CAuguRGo",offline=document.querySelector(".offline"),main=document.querySelector("main"),search=document.querySelector("input[type=\"search\"]"),button=document.querySelector("button"),template=document.getElementById("cat"),install=document.querySelector(".install");let installPromptEvent,registration;const observer=new IntersectionObserver(a=>{a.forEach(a=>{if(0<a.intersectionRatio){const b=a.target;if(observer.unobserve(b),"IMG"===b.nodeName)return b.src=`${b.dataset.src}${/\?/.test(b.dataset.src)?"&":"?"}${Math.random().toString().substr(2)}`;const c=b.classList;if(c.contains("photos"))return loadPhotos(b);if(c.contains("reviews"))return loadReviews(b);if(c.contains("offers"))return loadOffers(b)}})}),getCats=async a=>{const b=`https://commons.wikimedia.org/w/api.php
      ?action=query
      &generator=categorymembers
      &gcmlimit=max
      &gcmtype=file
      &gcmtitle=Category:${encodeURIComponent(a.replace(/\s/g," "))}
      &prop=imageinfo
      &iiurlwidth=500
      &iiprop=extmetadata|url
      &iiextmetadatafilter=ImageDescription
      &format=json&origin=*`.replace(/\n\s*/g,"");return fetch(b).then(a=>{if(!a.ok)throw new TypeError(`Could not load ${b}`);return a.json()}).then(a=>a&&a.query&&a.query.pages?Object.keys(a.query.pages).map(b=>{let c=a.query.pages[b];try{c=c.imageinfo[0];const a=c.thumburl,b=c.descriptionshorturl,d=c.thumbwidth,e=c.thumbheight,f=c.extmetadata.ImageDescription.value;return{url:b,src:a,description:f,width:d,height:e}}catch(a){}}).filter(a=>"undefined"!=typeof a):void 0).catch(a=>console.error(a))},renderCats=(a,b,c)=>{var d=Math.floor;const e=registration&&"pushManager"in registration,f=document.createDocumentFragment();a.forEach((c,g)=>{var h=Math.round;const i=document.importNode(b.content,!0),j=i.querySelector("figure img");j.alt=`Illustrative ${search.value.toLowerCase()} image`,j.classList.add("lazyload"),j.dataset.src=c.src;const k=i.querySelector("figcaption");if(k.textContent=(k.innerHTML=c.description,k.textContent),/took too long to load/.test(c.description))return;const l=i.querySelector(".pricedrop");e?l.querySelector("input").addEventListener("input",a=>{const b=a.target;if(b.checked){const a=b.parentNode;a.innerHTML=a.innerHTML.replace("\uD83D\uDECE","\u23F3"),(async()=>{const c=await pushNotifications();b.disabled=c,b.dataset.active="false",a.innerHTML=a.innerHTML.replace("\u23F3","\uD83D\uDECE"),l.querySelector("span").hidden=!c})()}}):l.hidden=!0;const m=i.querySelector(".stars");m.textContent=`Cuteness rating: ${"\uD83D\uDE3B".repeat(d(5*Math.random())+1)}`;const n=i.querySelector(".price");n.textContent=`Price range: ${"\uD83D\uDCB0".repeat(d(3*Math.random())+1)}`;const o=i.querySelector(".outlink");o.href=`./forward.html?url=${encodeURIComponent(c.url)}`,o.textContent="View Deal";const a=i.querySelector(".tabs");a.addEventListener("click",()=>{lazyLoadInit(a)});const p=a.querySelectorAll(".tab label"),q=a.querySelectorAll(".tabcontent");a.querySelectorAll(".tab input").forEach((a,b)=>{const c=Math.random().toString().substr(2);a.name=`tabgroup${g}`,a.id=c,p[b].setAttribute("for",c),q[b].setAttribute("aria-labelledby",c)});const r=a.querySelector(".map"),s=h(1e5*(90*((.5>Math.random()?-1:1)*Math.random())))/1e5,t=h(1e5*(180*((.5>Math.random()?-1:1)*Math.random())))/1e5;r.dataset.src=`https://maps.googleapis.com/maps/api/staticmap
        ?autoscale=1
        &size=500x350
        &maptype=terrain
        &key=AIzaSyBWZnCRi6oar3MTjR0HkR1lK52_mTe0Rks
        &format=png
        &markers=size:small%7Ccolor:0xfffb00%7C${s},${t}`.replace(/\n\s*/g,""),r.alt=`Map centered on latitude ${s} and longitude ${t}`,a.querySelector(".lat").textContent=s,a.querySelector(".long").textContent=t,f.appendChild(i)}),c.innerHTML="",c.appendChild(f)},loadOffers=a=>{const b=document.createDocumentFragment(),c=`https://www.random.org/integers/
      ?num=${Math.floor(4*Math.random())+2}
      &min=5&max=20&col=1&base=10&format=plain&rnd=new`.replace(/\n\s*/g,"");fetch(c).then(a=>{if(!a.ok)throw new TypeError(`Could not load ${c}`);return a.text()}).then(c=>{let d=c.split(/\n/g);d.splice(-1,1),d.map(a=>isNaN(parseInt(a,10))?a:parseInt(a+"9",10)).sort((c,a)=>c-a).map((a,c)=>{const d=document.createElement("li");d.textContent=/\d+/.test(a)?`From $${a} at Affiliate ${c}`:a,b.appendChild(d)}),a.innerHTML="",a.appendChild(b)}).catch(a=>console.error(a))},loadReviews=a=>{var b=Math.floor;const c=document.createDocumentFragment(),d=[];for(let c=0,e=b(6*Math.random())+2;c<e;c++){const a=`https://baconipsum.com/api/?type=all-meat&paras=${b(3*Math.random())+1}&start-with-lorem=1&random=${c}`;d[c]=fetch(a).then(b=>{if(!b.ok)throw new TypeError(`Could not load ${a}`);return b.json()}).then(a=>`<li>${a.map(a=>`<p>${a}</p>`).join("")}</li>`).catch(a=>console.error(a))}Promise.all(d).then(a=>a.join("")).then(b=>{const d=document.createElement("ul");d.innerHTML=b,c.appendChild(d),a.innerHTML="",a.appendChild(c)})},loadPhotos=a=>{var b=Math.floor;const c=document.createDocumentFragment(),d=document.createElement("div");d.classList.add("gallery"),c.appendChild(d);const e=[];for(let c=0,d=b(15*Math.random())+2;c<d;c++){const a=10*(b(10*Math.random())+20),d=10*(b(5*Math.random())+20),f=`https://placekitten.com/${a}/${d}?random=${c}`;e[c]=fetch(f).then(a=>{if(!a.ok)throw new TypeError(`Could not load ${f}`);return a.blob()}).then(b=>({width:a,height:d,blob:b}))}Promise.all(e).then(b=>{b.forEach(a=>{const b=new Image(a.width,a.height);b.alt=`Illustrative ${search.value.toLowerCase()} image`,b.src=URL.createObjectURL(a.blob),d.appendChild(b)}),a.innerHTML="",a.appendChild(c)}).catch(a=>console.error(a))},lazyLoadInit=(a=!1)=>{const b=a?a.querySelectorAll(".lazyload"):document.querySelectorAll(".lazyload");b.forEach(a=>{observer.observe(a)})};window.addEventListener("offline",()=>{offline.hidden=!1,search.disabled=!0,button.disabled=!0,document.querySelectorAll("input[data-active=\"true\"]").forEach(a=>{a.disabled=!0})}),window.addEventListener("online",()=>{offline.hidden=!0,search.disabled=!1,button.disabled=!1,document.querySelectorAll("input[data-active=\"true\"]").forEach(a=>{a.disabled=!1}),"false"===main.dataset.hydrated&&init(),lazyLoadInit()});const firstTimeSetup=()=>{document.querySelector("form").addEventListener("submit",a=>{a.preventDefault(),init()}),window.addEventListener("beforeinstallprompt",a=>{a.preventDefault(),installPromptEvent=a,install.disabled=!1,install.hidden=!1}),install.addEventListener("click",()=>{install.disabled=!0,install.hidden=!0,installPromptEvent.prompt(),installPromptEvent.userChoice.then(a=>{"accepted"===a.outcome?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),installPromptEvent=null})});for(let a=0;3>a;a++){const b=template.content,c=b.querySelectorAll(".tab label"),d=b.querySelectorAll(".tabcontent");b.querySelectorAll(".tab input").forEach((b,e)=>{const f=Math.random().toString().substr(2);b.name=`tabgroup${a}`,b.id=f,c[e].setAttribute("for",f),d[e].setAttribute("aria-labelledby",f)}),main.appendChild(document.importNode(b,!0))}const a=navigator.onLine;offline.hidden=a,search.disabled=!a,button.disabled=!a,a&&init(),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(a=>{registration=a,registration.onupdatefound=cachePolyfills,cachePolyfills()}).catch(a=>console.error(a))},pushNotifications=async()=>{if(!registration||!("pushManager"in registration))return!1;const a=a=>{const b="=".repeat((4-a.length%4)%4),c=(a+b).replace(/\-/g,"+").replace(/_/g,"/"),d=window.atob(c),e=new Uint8Array(d.length);for(let b=0;b<d.length;++b)e[b]=d.charCodeAt(b);return e};return registration.pushManager.getSubscription().then(b=>{if(b)return b;const c=a(VAPID_PUBLIC_KEY);return registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:c})}).then(a=>(fetch("https://affilicats-push.glitch.me/push/sendNotification",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({subscription:a,delay:5,ttl:0})}),fetch("https://affilicats-push.glitch.me/push/register",{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify({subscription:a})}).then(a=>a.ok))).catch(a=>(console.error(a),!1))},cachePolyfills=async()=>{const a=async a=>{const b=new Request(a,{mode:"no-cors"});return fetch(b).then(a=>c.put(b,a)).catch(a=>console.error(a))},b=await caches.keys(),c=await caches.open(b.filter(a=>/^offline_/.test(a))[0]);for(let b=0;b<localStorage.length;b++){const c=localStorage.key(b);"polyfill"===localStorage.getItem(c)&&("IntersectionObserver"===c?a("https://unpkg.com/intersection-observer@0.5.0/intersection-observer.js"):"PWACompat"===c?a("https://unpkg.com/pwacompat@2.0.7/pwacompat.min.js"):"URLSearchParams"===c?a("https://unpkg.com/url-search-params@1.1.0/build/url-search-params.js"):void 0)}},init=async()=>{const a=new URLSearchParams(document.location.search),b=a.get("query");b&&!search.value&&(search.value=b),b||search.value||(search.value=DEFAULT_SEARCH);const c=search.value||DEFAULT_SEARCH,d=await getCats(c);Array.isArray(d)&&0<d.length?(main.dataset.hydrated="true",c!==DEFAULT_SEARCH&&history.pushState({},"",`${document.location.origin}${document.location.pathname}?query=${encodeURIComponent(c)}`),renderCats(d,template,main)):main.innerHTML=`<p>üò• No results found.</p>
        <p>Try anything that is a
        <a href="https://commons.wikimedia.org/wiki/Category:Topics">
        Wikimedia Categorie</a>. Maybe try
        <a href="./?query=Elephants">Elephants</a> üêò</p>`,lazyLoadInit()};firstTimeSetup();